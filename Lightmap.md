A lightmap is a type of texture that contains [[Lighting]] information.
It is a type of acceleration structure that makes runtime lighting calculations faster.
The lightmap is generated, also called baked, ahead of time, for example while a project is being packaged.
[[Lighting]] making use of a Lightmap is called [[Static Lighting]] or baked lighting.
In Unreal Engine the tool that generates lightmaps is called [[Lightmass]].
The Lightmap is managed and applied internally in the engine, you usually don't see or edit the Lightmap itself,
but you can edit settings on other objects that affects the Lightmap, such as [[Light Source]] settings, light bake settings in the [[World Settings]], and Lightmap resolution on a [[Static Mesh]].

Each [[Mesh]] that should receive [[Static Lighting]] need a lightmap UV channel.
This is a type of texture coordinate that guarantees that every point on the mesh map to a unique point on the lightmap.
There can be no overlaps.

For light baking into Lightmaps to be possible both the [[Light Source]] and the [[Mesh]] must have its [[Mobility]] set to non-movable, i.e. either Static or Stationary.
Static allows for more baking than Stationary.
See [[Static Lighting]] for more details.

# Lightmap Size

Each [[Mesh]] that should receive [[Static Lighting]] will be given a Lightmap texture.
The size of that texture is set at [[Static Mesh Editor]] > Details panel > General Settings > Light Map Resolution.
Can be overridden for a particular [[Static Mesh Component]] at [[Details Panel]] > Lighting > Overridden Light Map Res.
The resolution is the side length in texels, i.e. entering 64 will give you a 64x64 texel texture.
Reasonable numbers are 32 for things small enough to be placed on a table, 64 for kinda small things, 1024 for medium sized things (furniture?), and 2048 for large things, such as buildings.
I think, I'm making up numbers here. Experiment and see what happens.
If you set the size too small then you get too blurry and possibly even blocky shadows.
If you set the size too large then
- Light baking will take a very long time.
- The shadow maps will not fit in VRAM during runtime.
- Runtime performance will be very poor.

The Lightmap size can be visualized with [[View Mode]] > Optimization Viewmodes > Lightmap Density.
This is one of the [[Lighting View Modes]].
This can help you determine which lightmaps should be bigger, which should be smaller, and which are just right.


When working with lightmaps it can help to switch the [[View Mode]] to Lighting Only.
And to disable [[Level Viewport]] > Show > Lighting Features > Screen Space Ambient Occlusion.
This makes it easier to see the contributions from [[Static Lighting]] only.

After baking lighting you can see the final Lightmaps in [[World Settings]] > [[Lightmass]] > Lightmaps.

A Lightmap contains multiple sections.
One section contains the colors and shadows computed during light baking.
It is multiplied into the material color in the shader when the object is rendered.


# Lightmap UVs

A Lightmap can only be generated for a [[Static Mesh]] that has Lightmap UVs.
These are similar to regular [[Texture]] coordinates, but with more restrictions.
Textures UVs may not be overlapping.
In fact, different parts of the mesh should not be mapped to parts of the UV space that is close to other parts of the mesh to prevent bleeding of the Lightmap data.
These should be a bit of gap between triangles in the UV map.
They cannot be flipped. Not sure what that means.
They must be "closed" (Not sure if correct word.), i.e. all points on the mesh must map to a UV coordinate within the [0..1] bounds, i.e., no wrapping or clamping.
In fact, stay a bit away from the edge, keep a buffer zone around the edges of the [0..1] space.
In short, every point on the mesh must map to a unique point in [0..1] UV space, and no other point on the mesh may map to the same UV point.

A mesh often have one UV channel for regular textures and another UV channel for Lightmap UVs.
The Lightmap UV channel is set with [[Static Mesh Editor]] > Details panel > General Settings > Advanced > Light Map Coordinate Index.
By default this is 1, which regular textures using UV channel 0.

The second UV channel can be generated by the engine.
This is done from [[Static Mesh Editor]] > [[Details Panel]] > LOD 0 > Build Settings.
In the Build settings, set Destination Lightmap Index to the UV channel in which the generated Lightmap UVs should be generated.
Source Lightmap Index should probably be set to 0, but I don't know what that means, really.
Click Build Settings > Apply Changes.
For more details see _Generate Lightmap UVs_ below.

One way to generate the Lightmap UV channel is to let it be created when the mesh is imported. This is on by default.


## Generate Lightmap UVs

One way to generate the Lightmap UV channel is to use the [[Static Mesh Editor]].
Enable [[Static Mesh Editor]] > Details panel > LOD 0 (Or #? Does each [[LOD]] level have its own Lightmap?) > Generate Lightmap UVs.
Next to that is Source Lightmap Index and Destination Lightmap Index.
I don't know what the source is used for.
Destination Lightmap Index is the UV channel to write the the generated Lightmap UVs to.
The destination should not be the same as the source.
The destination can be one higher than the highest currently available UV channel, in which case the engine will create the new UV channel.
I don't think you can have gaps in the channel indices.
The Destination Lightmap Index should often match the setting [[Details Panel]] > General Settings > Advanced > Light Map Coordinate Index.
Click [[Static Mesh Editor]] > Details panel > LOD 0 (Or #? Does each [[LOD]] level have its own Lightmap?) > Apply Changes.
You can see the result by selecting the UV channel selected for Destination Lightmap Index in [[Static Mesh Editor]] > Main Tool Bar > UV.

The padding between mesh shell segments is specified at [[Static Mesh Editor]] > Details panel > LOD 0 (Or #? Does every [[LOD]] level have its own Lightmap?) > Build Settings > Min Lightmap Resolution.
A higher number means less padding between neighboring shells.
A smaller number means more padding between neighboring shells.
Increase the padding, i.e. decrease Min Lightmap Resolution, if you see light bleeding from one part of a mesh to another.


You can see the Lightmap UVs in the [[Static Mesh Editor]].
Expand the [[Static Mesh Editor]] > Top Tool Bar > UV drop-down menu.


# Volumetric Lightmap

A second type of Lightmap that is also generated by [[Lightmass]].
This Lightmap is not per [[Mesh]] but per world grid cell, i.e., there is a bunch of sample points scattered across the world.
[[Lightmass]] computes the incoming light at each such sample point.
This information is used when rendering a dynamic [[Mesh]] in the world.
Dynamic objects can't use a Lightmap, but it can use the baked Volumetric Lightmap information.

The Volumetric Lightmap can be visualized with Viewport > Show > Visualize > Volumetric Lightmap.
Will show up as spheres arranged in a regular grid in the world.
Where there is a Lightmass Importance Volume there will be more spheres than where there isn't a Lightmass Importance Volume.
There will be more spheres close to static geometry in the level.
(
I did not get this to show anything.
What is needed for the spheres to show up?
I have a [[Lightmass Importance Volume]] and a [[Point Light]] with [[Mobility]] set to Static.
I had to [[Baked Lighting|Bake Lighting]].
But the spheres are very very bright. As in the entire screen is while bright.
)

The density/resolution of the Volumetric Lightmap is controlled with Volumetric Lightmap Detail Cell Size.
Don't know where this setting is, not in the [[Project Settings]] and not on a [[Directional Light]], and not on a [[Lightmass Importance Volume]].

The Lightmap density can be visualized with Viewport > Lit > Optimization Viewmodes > Lightmap Density.
Expensive areas will show up in red.
A grid pattern show the size of the Light Map texture on each mesh.
Not sure how to interpret the size of the squares, but smaller means more expensive.
Not sure what a reasonable size would be, of when one would want smaller or larger squares.
Find the red meshes and override the scale/density.
Not sure what this means exactly.
[[Static Mesh Editor]] > Details panel > LOD 0 > Build Settings > Min Lightmap Resolution?
[[Static Mesh Editor]] > Details panel > General Settings > Light Map Resolution?
[[Static Mesh Component]] > Details panel > Lighting > Overriden Light Map Resolution?
Something else?


# References

- [_Introduction To Global Illumiation_, by Epic Games @ dev.epicgames.com, UE-4.20](https://dev.epicgames.com/community/learning/courses/yon/introducing-global-illumination/yo8/introduction-to-global-illumination)
- [_Lighting Essential Concepts and Effects - Baked Lighting - Lightmaps_, by Epic Games @ dev.epicgames.com, 2018](https://dev.epicgames.com/community/learning/courses/Xwp/lighting-essential-concepts-and-effects/zVO/baked-lighting-lightmaps)
- [_Lighting Essential Concepts and Effects - Combining Static and Dynamic Lighting_, by Epic Games @ dev.epicgames.com, 2018](https://dev.epicgames.com/community/learning/courses/Xwp/lighting-essential-concepts-and-effects/P0R/combining-static-and-dynamic-lighting)
- [_Becoming an Environment Artist in Unreal Engine_ > _Lighting_ by Epic Online Learning @ dev.epicgames.com/courses 2020 UE 4.25](https://dev.epicgames.com/community/learning/courses/Gm/becoming-an-environment-artist-in-unreal-engine/oE6/unreal-engine-lighting)

